<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberSecure Quiz</title>
  <style>
    :root{
      --bg:#0f172a;--panel:#111827;--muted:#94a3b8;--txt:#e5e7eb;--accent:#22c55e;--accent2:#3b82f6;--danger:#ef4444;--card:#0b1220;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Arial;background:linear-gradient(180deg,#0b1020,#0f172a);color:var(--txt);min-height:100svh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:1040px;background:rgba(17,24,39,.7);backdrop-filter:saturate(120%) blur(8px);border:1px solid rgba(148,163,184,.15);border-radius:24px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.4)}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(90deg,#0b1220,#111827)}
    header h1{margin:0;font-size:clamp(18px,2.6vw,24px);letter-spacing:.5px}
    .actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{border:none;border-radius:14px;padding:10px 14px;font-weight:600;cursor:pointer;color:#fff;background:#1f2937;transition:transform .06s ease,opacity .2s}
    .btn:hover{opacity:.9}.btn:active{transform:scale(.98)}
    .btn.primary{background:var(--accent2)}.btn.success{background:var(--accent)}.btn.ghost{background:transparent;border:1px solid rgba(148,163,184,.25)}
    .content{display:grid;grid-template-columns:1fr;gap:0}
    @media(min-width:1000px){.content{grid-template-columns:1.6fr 1.1fr}}
    .main{padding:20px;background:radial-gradient(1200px 600px at 50% -10%, rgba(59,130,246,.14), transparent),linear-gradient(180deg,rgba(148,163,184,.06),transparent)}
    .panel{padding:16px 18px;border-inline-start:1px solid rgba(148,163,184,.15);background:linear-gradient(180deg,rgba(2,6,23,.65), rgba(2,6,23,.15))}
    .card{background:var(--card);border:1px solid rgba(148,163,184,.12);border-radius:18px;padding:16px;box-shadow:inset 0 1px 0 rgba(255,255,255,.02)}
    .meta{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:14px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(148,163,184,.2);color:#cbd5e1;padding:6px 10px;border-radius:999px;font-size:13px}
    .timer{--w:100%;height:10px;background:#111827;border-radius:999px;overflow:hidden;border:1px solid rgba(148,163,184,.2)}
    .timer>i{display:block;height:100%;width:var(--w);background:linear-gradient(90deg,var(--accent),#eab308);transition:width .2s linear}
    .q-title{font-size:clamp(18px,2.4vw,22px);margin:12px 0 6px}
    .options{display:grid;grid-template-columns:1fr;gap:10px;margin-top:14px}
    .option{color: var(--txt); display:flex;gap:10px;align-items:center;background:#0b1220;border:1px solid rgba(148,163,184,.25);border-radius:14px;padding:12px;cursor:pointer;transition:background .2s,border-color .2s}
    .option:hover{background:#0f172a}.option.correct{border-color:rgba(34,197,94,.8)}.option.wrong{border-color:rgba(239,68,68,.9)}
    .explain{margin-top:10px;color:#cbd5e1;font-size:14px}
    .leaderboard h3,.rules h3,.settings h3{margin:8px 0 12px;font-size:18px}
    .lb-list{display:grid;gap:8px}.lb-item{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#0b1220;border:1px solid rgba(148,163,184,.18);border-radius:12px}
    .muted{color:var(--muted)}
    .end{display:none;gap:16px}.end.active{display:block}.center{text-align:center}.small{font-size:12px;color:var(--muted)}.hidden{display:none}
    .badge{background:linear-gradient(90deg,#22c55e,#3b82f6);color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;margin-inline-start:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    select,input[type="number"],input[type="text"]{padding:8px 10px;border-radius:12px;border:1px solid rgba(148,163,184,.3);background:#0b1220;color:#e5e7eb}
    .switch{display:inline-flex;align-items:center;gap:8px}
    .switch input{accent-color:#22c55e}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>CyberSecure Quiz <span class="badge">نسخة تجريبية</span></h1>
      <div class="actions">
        <button class="btn ghost" id="toggleDir">RTL/LTR</button>
        <button class="btn" id="resetBtn">إعادة</button>
        <button class="btn primary" id="headerStartBtn">ابدأ اللعب</button>
      </div>
    </header>

    <div class="content">
      <main class="main">
        <div class="card">
          <div class="meta">
            <div>السؤال <b id="qIndex">0</b>/<b id="qTotal">0</b></div>
            <div>النقاط: <b id="score">0</b></div>
            <div>سلسلة صحيحة: <b id="streak">0</b></div>
            <div>زمن السؤال: <b id="sec">0</b>s</div>
          </div>
          <div class="timer" aria-hidden="true"><i id="bar"></i></div>
          <h2 class="q-title" id="qTitle">اضغط "ابدأ اللعب" للانطلاق</h2>
          <div class="options" id="options"></div>
          <div class="explain" id="explain"></div>
          <div class="center" style="margin-top:14px">
            <button class="btn success hidden" id="nextBtn">السؤال التالي</button>
          </div>
        </div>

        <div class="card end" id="endCard">
          <h2 class="center">أحسنت! انتهت الجولة 🎉</h2>
          <p class="center">درجتك: <b id="finalScore">0</b></p>
          <div class="center" style="margin:10px 0">
            <input id="playerName" placeholder="اكتب اسمك للحفظ في لوحة الشرف" style="padding:10px 12px;border-radius:12px;border:1px solid rgba(148,163,184,.3);background:#0b1220;color:#e5e7eb;width:min(420px,90%)" />
            <button class="btn primary" id="saveLB">حفظ</button>
          </div>
          <div class="center row" style="justify-content:center">
            <button class="btn" id="playAgain">لعبة جديدة</button>
            <button class="btn ghost" id="shareBtn">مشاركة الدرجة</button>
            <button class="btn ghost" id="qrBtn">QR</button>
          </div>
          <canvas id="qrCanvas" class="hidden" width="220" height="220" style="margin:10px auto;display:block;background:#fff;border-radius:12px;padding:6px"></canvas>
        </div>
      </main>

      <aside class="panel">
        <section class="settings">
          <h3>إعدادات الجولة ⚙️</h3>
          <div class="row">
            <label class="switch">اللغة:
              <select id="langSel">
                <option value="ar">العربية</option>
                <option value="en">English</option>
              </select>
            </label>
            <label class="switch">المستوى:
              <select id="levelSel">
                <option value="easy">سهل</option>
                <option value="med" selected>متوسط</option>
                <option value="hard">صعب</option>
              </select>
            </label>
            <label class="switch">التصنيف:
              <select id="catSel">
                <option value="all" selected>الكل</option>
                <option value="passwords">Passwords</option>
                <option value="phishing">Phishing</option>
                <option value="wifi">Wi‑Fi & VPN</option>
              </select>
            </label>
          </div>
          <div class="row" style="margin-top:8px">
            <label class="switch"><input type="checkbox" id="soundChk" checked> أصوات</label>
            <label class="switch"><input type="checkbox" id="negChk"> خصم على الخطأ (‑10)</label>
            <label class="switch hidden"><input type="checkbox" id="streakChk" checked> مضاعف سلسلة الإجابات</label>
            <button class="btn ghost" id="settingsToggleDir">RTL/LTR</button>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="settingsResetBtn">إعادة</button>
            <button class="btn primary" id="settingsStartBtn">ابدأ اللعب</button>
          </div>
        </section>

        <section class="leaderboard" style="margin-top:16px">
          <h3>لوحة الشرف 🏆</h3>
          <div class="lb-list" id="lbList"></div>
          <p class="small">يتم التخزين محليًا في المتصفح. يمكنك تصدير/استيراد الأسئلة أدناه.</p>
        </section>
        <section class="rules" style="margin-top:16px">
          <h3>إدارة بنك الأسئلة</h3>
          <div class="row">
            <button class="btn ghost" id="exportBtn">تصدير JSON</button>
            <label class="btn ghost" for="importFile">استيراد JSON</label>
            <input id="importFile" type="file" accept="application/json" class="hidden" />
          </div>
          <p class="small">تنسيق السؤال: {type, q, options[], answer, explain, category, lang}</p>
        </section>
        <section class="rules" style="margin-top:16px">
          <h3>قواعد سريعة</h3>
          <ul class="muted" style="margin-top:6px;line-height:1.8">
            <li>الزمن يتغير حسب المستوى (سهل 25s / متوسط 20s / صعب 12s).</li>
            <li>نقاط صحيحة حتى 100 + مكافأة سلسلة صحيحة.</li>
            <li>يمكن تفعيل خصم ‑10 عند الخطأ.</li>
          </ul>
        </section>
      </aside>
    </div>
  </div>
  </div>

  <script>
    // ===== ترجمات بسيطة =====
    const I18N = {
      ar: {
        start: 'ابدأ اللعب', next: 'السؤال التالي', finished: 'أحسنت! انتهت الجولة 🎉',
        yourScore: 'درجتك', noResults: 'لا توجد نتائج بعد.'
      },
      en: {
        start: 'Start', next: 'Next', finished: 'Great! Round finished 🎉',
        yourScore: 'Your score', noResults: 'No results yet.'
      }
    };

    // ===== بنك أسئلة متعدد اللغات/التصنيفات =====
    let QUESTIONS = [
      {lang:'ar', category:'passwords', type:'mcq', q:'أي كلمة مرور أقوى؟', options:['Riyadh2024','R!y@dh-2_0_2_4','12345678','Qwerty!'], answer:1, explain:'الأقوى مزيج من أحرف كبيرة/صغيرة + أرقام + رموز، وطول 12+.'},
      {lang:'ar', category:'phishing', type:'tf', q:'تفعيل 2FA يقلل من خطر اختراق حسابك.', options:['صح','خطأ'], answer:0, explain:'2FA يضيف طبقة حماية ثانية بعد كلمة المرور.'},
      {lang:'ar', category:'phishing', type:'scenario', q:'وصلك إيميل خصم 90% وطلب بطاقتك. ماذا تفعل؟', options:['أضغط الرابط بسرعة','أتأكد من الرابط والمرسل وأتواصل مع الدعم الرسمي'], answer:1, explain:'العروض الضخمة المستعجلة تكتيك تصيّد.'},
      {lang:'ar', category:'phishing', type:'mcq', q:'ما هو التصيّد (Phishing)؟', options:['اختبار الشبكة','خداعك للكشف عن بياناتك','تحديثات أمنية','نسخ احتياطي'], answer:1, explain:'رسائل/مواقع مزورة تقلّد جهات موثوقة.'},
      {lang:'ar', category:'wifi', type:'mcq', q:'أي امتداد ملف تحذر منه بالبريد؟', options:['.pdf','.jpg','.exe','.txt'], answer:2, explain:'ملفات التنفيد قد تحتوي برمجيات خبيثة.'},
      {lang:'ar', category:'wifi', type:'tf', q:'تحديثات النظام لسد الثغرات.', options:['صح','خطأ'], answer:0, explain:'تُحسن الحماية.'},
      {lang:'ar', category:'wifi', type:'scenario', q:'Wi‑Fi عامة بدون كلمة مرور. ماذا تفعل؟', options:['أدخل بياناتي البنكية','أستخدم VPN أو أؤجل المعاملات الحساسة'], answer:1, explain:'تجنب إدخال بيانات حساسة على شبكات عامة.'},
      
      // أسئلة عربية إضافية
      {lang:'ar', category:'phishing', type:'mcq', q:'ما هي الهندسة الاجتماعية؟', options:['هجمات إلكترونية','استخدام الخداع النفسي للحصول على معلومات سرية','اختراق شبكة الواي فاي','تطوير تطبيقات أمنية'], answer:1, explain:'الهندسة الاجتماعية تعتمد على استغلال العامل البشري.'},
      {lang:'ar', category:'passwords', type:'mcq', q:'ما هي أهمية استخدام مدير كلمات المرور؟', options:['لحفظ كلمة مرور واحدة فقط','لتحسين سرعة الإنترنت','لإنشاء وتخزين كلمات مرور قوية وفريدة بشكل آمن','للتأكد من أن المواقع آمنة'], answer:2, explain:'مدير كلمات المرور يسهل عملية استخدام كلمات مرور معقدة ومختلفة لكل موقع.'},
      {lang:'ar', category:'wifi', type:'tf', q:'شبكة Wi-Fi التي تحمل اسم "Free Public Wi-Fi" هي دائمًا آمنة.', options:['صح','خطأ'], answer:1, explain:'الشبكات العامة المجانية غالبًا ما تكون غير آمنة وقد تسمح للمتسللين بالوصول إلى بياناتك.'},
      
      // English questions
      {lang:'en', category:'passwords', type:'mcq', q:'What is a good way to protect your passwords?', options:['Reuse the same password on all sites','Write them down on a sticky note','Use a strong, unique password for each account'], answer:2, explain:'Using unique, strong passwords prevents one compromised account from affecting others.'},
      {lang:'en', category:'phishing', type:'tf', q:'Phishing emails are always easy to spot.', options:['True','False'], answer:1, explain:'Modern phishing emails can be very convincing and hard to distinguish from legitimate ones.'},
      {lang:'en', category:'phishing', type:'mcq', q:'Which of the following is a sign of a phishing attempt?', options:['A generic greeting like "Dear Customer"','An urgent request for personal information','A link with a suspicious URL','All of the above'], answer:3, explain:'Phishing attempts often use a combination of these tactics to deceive you.'},
      {lang:'en', category:'wifi', type:'mcq', q:'What is a firewall?', options:['A physical wall to block hackers','A security system that controls network traffic','A type of antivirus software','A public Wi-Fi access point'], answer:1, explain:'A firewall acts as a barrier, monitoring and controlling incoming and outgoing network traffic.'},
      {lang:'en', category:'wifi', type:'tf', q:'Using a VPN on public Wi-Fi is a good security practice.', options:['True','False'], answer:0, explain:'A VPN encrypts your traffic, protecting your data from being intercepted on unsecured networks.'},
      {lang:'en', category:'passwords', type:'scenario', q:'You receive a text from a bank asking you to log in to verify your account. What should you do?', options:['Click the link and log in immediately','Call the bank using the number on their official website','Reply to the text asking for more info'], answer:1, explain:'Never click on links in suspicious messages. Always use an official, verified contact method.'},
      
      // English questions additional
      {lang:'en', category:'phishing', type:'mcq', q:'What does "malware" stand for?', options:['Malicious software','Management software','Marketing software','Maintenance software'], answer:0, explain:'Malware is a broad term for any malicious software designed to harm or exploit a device.'},
      {lang:'en', category:'phishing', type:'tf', q:'It is safe to download attachments from senders you don\'t know.', options:['True','False'], answer:1, explain:'Unknown attachments can contain malware, so it\'s best to avoid them.'},
      {lang:'en', category:'passwords', type:'mcq', q:'Why is it important to update your software and operating system regularly?', options:['To get new features','To fix bugs and security vulnerabilities','To change the look of the interface','To make your device run faster'], answer:1, explain:'Updates often include security patches that fix weaknesses hackers can exploit.'},
      {lang:'en', category:'wifi', type:'tf', q:'You should disable Bluetooth and Wi-Fi when you are not using them.', options:['True','False'], answer:0, explain:'Disabling them reduces your device\'s visibility and potential attack surface.'}
    ];
    // ===== أصوات خفيفة =====
    const SND = {
      ok: new Audio(URL.createObjectURL(new Blob([new Uint8Array([82,73,70,70,26,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,1,0,8,0,100,97,116,97,2,0,0,0,255,127])],{type:'audio/wav'}))),
      no: new Audio(URL.createObjectURL(new Blob([new Uint8Array([82,73,70,70,26,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,1,0,8,0,100,97,116,97,2,0,0,0,0,128])],{type:'audio/wav'})))
    };

    // ===== حالة اللعبة =====
    const state = { idx:0, score:0, order:[], running:false, time:20, timerId:null, streak:0 };

    // DOM
    const qTitle = document.getElementById('qTitle');
    const optionsEl = document.getElementById('options');
    const explainEl = document.getElementById('explain');
    const qIndexEl = document.getElementById('qIndex');
    const qTotalEl = document.getElementById('qTotal');
    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');
    const secEl = document.getElementById('sec');
    const barEl = document.getElementById('bar');
    const nextBtn = document.getElementById('nextBtn');
    const headerStartBtn = document.getElementById('headerStartBtn');
    const headerResetBtn = document.getElementById('resetBtn');
    const settingsStartBtn = document.getElementById('settingsStartBtn');
    const settingsResetBtn = document.getElementById('settingsResetBtn');
    const endCard = document.getElementById('endCard');
    const finalScore = document.getElementById('finalScore');
    const playAgain = document.getElementById('playAgain');
    const playerName = document.getElementById('playerName');
    const saveLB = document.getElementById('saveLB');
    const lbList = document.getElementById('lbList');
    const headerToggleDir = document.getElementById('toggleDir');
    const settingsToggleDir = document.getElementById('settingsToggleDir');
    const langSel = document.getElementById('langSel');
    const levelSel = document.getElementById('levelSel');
    const catSel = document.getElementById('catSel');
    const soundChk = document.getElementById('soundChk');
    const negChk = document.getElementById('negChk');
    const streakChk = document.getElementById('streakChk');
    const shareBtn = document.getElementById('shareBtn');
    const qrBtn = document.getElementById('qrBtn');
    const qrCanvas = document.getElementById('qrCanvas');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');

    // ===== أدوات مساعدة =====
    const shuffle = arr => arr.map(v=>[v,Math.random()]).sort((a,b)=>a[1]-b[1]).map(x=>x[0]);
    const clamp = (n,min,max)=> Math.max(min, Math.min(max,n));

    function loadLB(){try{return JSON.parse(localStorage.getItem('cyber_leaderboard')||'[]')}catch{return[]}}
    function saveLBData(rows){localStorage.setItem('cyber_leaderboard', JSON.stringify(rows.slice(0,20)))}
    function renderLB(){
      const rows = loadLB();
      lbList.innerHTML = rows.length? '' : `<span class="muted">${I18N[langSel.value].noResults}</span>`;
      rows.forEach((r,i)=>{
        const div=document.createElement('div');div.className='lb-item';div.innerHTML=`<span>#${i+1} — ${r.name}</span><b>${r.score}</b>`;lbList.appendChild(div);
      });
    }

    // ===== منقي الأسئلة حسب اللغة/التصنيف =====
    function pool(){
      const lang = langSel.value, cat = catSel.value;
      const arr = QUESTIONS.filter(q => q.lang===lang && (cat==='all' || q.category===cat));
      return arr.length? arr : QUESTIONS.filter(q=>q.lang===lang); // fallback
    }

    function startGame(){
      state.idx=0; state.score=0; state.running=true; state.streak=0; endCard.classList.remove('active');
      const items = pool();
      state.order = shuffle([...Array(items.length).keys()]);
      qTotalEl.textContent = items.length; scoreEl.textContent=0; streakEl.textContent=0; nextBtn.classList.add('hidden');
      renderQuestion();
    }

    function levelTime(){ return levelSel.value==='easy'?25 : levelSel.value==='hard'?12 : 20; }

    function renderQuestion(){
      clearInterval(state.timerId); explainEl.textContent=''; optionsEl.innerHTML=''; nextBtn.classList.add('hidden');
      const items = pool(); const qi = state.order[state.idx]; const q = items[qi];
      qIndexEl.textContent = state.idx + 1; qTitle.textContent = q.q;
      q.options.forEach((opt, idx)=>{ const btn=document.createElement('button'); btn.className='option'; btn.innerHTML=`<span class="pill">${idx+1}</span> <span>${opt}</span>`; btn.onclick=()=>pick(idx,q); optionsEl.appendChild(btn); });
      state.time = levelTime(); secEl.textContent=state.time; barEl.style.setProperty('--w','100%');
      state.timerId=setInterval(()=>{ state.time-=1; secEl.textContent=state.time; const w=clamp((state.time/levelTime())*100,0,100); barEl.style.setProperty('--w', w+'%'); if(state.time<=0){ clearInterval(state.timerId); lock(null,q); } },1000);
    }

    function pick(idx,q){ if(!state.running) return; clearInterval(state.timerId); lock(idx,q); }

    function lock(idx,q){
      const nodes=[...document.querySelectorAll('.option')]; nodes.forEach(n=> n.onclick=null);
      const items = pool(); const correct=q.answer; nodes.forEach((n,i)=>{ if(i===correct) n.classList.add('correct'); });
      if(idx!==null && idx!==undefined){
        if(idx===correct){
          const base = Math.round(50 + (state.time/levelTime())*50);
          state.streak += 1; let bonus = (streakChk.checked? (state.streak-1)*10 : 0); const gained = base + bonus; state.score += gained; if(soundChk.checked) SND.ok.play();
        } else {
          state.streak = 0; if(negChk.checked) state.score = Math.max(0, state.score - 10); nodes[idx].classList.add('wrong'); if(soundChk.checked) SND.no.play();
        }
      } else { state.streak=0; if(negChk.checked) state.score = Math.max(0, state.score - 10); }
      scoreEl.textContent = state.score; streakEl.textContent=state.streak; explainEl.textContent = q.explain || '';
      nextBtn.classList.remove('hidden');
    }

    function next(){ if(state.idx < state.order.length-1){ state.idx+=1; renderQuestion(); } else { end(); } }
    function end(){ state.running=false; clearInterval(state.timerId); finalScore.textContent=state.score; endCard.classList.add('active'); }

    // ===== مشاركة و QR =====
    shareBtn.addEventListener('click', async () => {
    const txt = `${document.title} - ${state.score}`;
    try {
      await navigator.clipboard.writeText(txt + ' ' + location.href);
      alert('تم نسخ الرابط! يمكنك مشاركته الآن.');
    } catch (err) {
      alert('حدث خطأ أثناء النسخ.');
    }
});

    // QR بسيط (Placeholder pattern، لا يعتمد مكتبات خارجية)
    qrBtn?.addEventListener('click', ()=>{
      const c=qrCanvas, ctx=c.getContext('2d'); c.classList.toggle('hidden');
      if(c.classList.contains('hidden')) return;
      ctx.fillStyle='#fff'; ctx.fillRect(0,0,c.width,c.height);
      // رسم مربعات نمطية (ليس QR حقيقي؛ للتجربة فقط)
      ctx.fillStyle='#000';
      for(let y=0;y<21;y++) for(let x=0;x<21;x++) if(((x*y + x + y)%7)===0) ctx.fillRect(10+x*9,10+y*9,7,7);
      ctx.fillStyle='#000'; ctx.fillRect(12,12,50,50); ctx.clearRect(20,20,34,34); // عين
      ctx.fillRect(158,12,50,50); ctx.clearRect(166,20,34,34);
      ctx.fillRect(12,158,50,50); ctx.clearRect(20,166,34,34);
    });

    // ===== تصدير/استيراد الأسئلة =====
    exportBtn?.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(QUESTIONS,null,2)], {type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='questions.json'; a.click(); URL.revokeObjectURL(a.href);
    });
    importFile?.addEventListener('change', async (e)=>{
      const file = e.target.files?.[0]; if(!file) return; const txt = await file.text();
      try{ const data = JSON.parse(txt); if(Array.isArray(data)){ QUESTIONS = data; alert('تم الاستيراد بنجاح'); } else alert('صيغة غير صحيحة'); }
      catch{ alert('فشل قراءة الملف'); }
    });

    // ===== أحداث عامة =====
    headerStartBtn.addEventListener('click', startGame);
    headerResetBtn.addEventListener('click', ()=>{ state.running=false; clearInterval(state.timerId); startGame(); });
    settingsStartBtn.addEventListener('click', startGame);
    settingsResetBtn.addEventListener('click', ()=>{ state.running=false; clearInterval(state.timerId); startGame(); });
    nextBtn.addEventListener('click', next);
    playAgain.addEventListener('click', startGame);
    saveLB.addEventListener('click', ()=>{ const name=(playerName.value||'لاعب مجهول').slice(0,32); const rows=loadLB(); rows.push({name,score:state.score,ts:Date.now()}); rows.sort((a,b)=> b.score-a.score || a.ts-b.ts); saveLBData(rows); renderLB(); playerName.value=''; });
    headerToggleDir.addEventListener('click', ()=>{ const r=document.documentElement; r.setAttribute('dir', r.getAttribute('dir')==='rtl' ? 'ltr' : 'rtl'); });
    settingsToggleDir.addEventListener('click', ()=>{ const r=document.documentElement; r.setAttribute('dir', r.getAttribute('dir')==='rtl' ? 'ltr' : 'rtl'); });
    langSel.addEventListener('change', ()=>{ renderLB(); });

    // بداية
    renderLB();
  </script>
</body>
</html>
