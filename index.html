<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberSecure Quiz</title>
  <style>
    :root{
      --bg:#0f172a;--panel:#111827;--muted:#94a3b8;--txt:#e5e7eb;--accent:#22c55e;--accent2:#3b82f6;--danger:#ef4444;--card:#0b1220;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Arial;background:linear-gradient(180deg,#0b1020,#0f172a);color:var(--txt);min-height:100svh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:1040px;background:rgba(17,24,39,.7);backdrop-filter:saturate(120%) blur(8px);border:1px solid rgba(148,163,184,.15);border-radius:24px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.4)}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(90deg,#0b1220,#111827)}
    header h1{margin:0;font-size:clamp(18px,2.6vw,24px);letter-spacing:.5px}
    .actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{border:none;border-radius:14px;padding:10px 14px;font-weight:600;cursor:pointer;color:#fff;background:#1f2937;transition:transform .06s ease,opacity .2s}
    .btn:hover{opacity:.9}.btn:active{transform:scale(.98)}
    .btn.primary{background:var(--accent2)}.btn.success{background:var(--accent)}.btn.ghost{background:transparent;border:1px solid rgba(148,163,184,.25)}
    .content{display:grid;grid-template-columns:1fr;gap:0}
    @media(min-width:1000px){.content{grid-template-columns:1.6fr 1.1fr}}
    .main{padding:20px;background:radial-gradient(1200px 600px at 50% -10%, rgba(59,130,246,.14), transparent),linear-gradient(180deg,rgba(148,163,184,.06),transparent)}
    .panel{padding:16px 18px;border-inline-start:1px solid rgba(148,163,184,.15);background:linear-gradient(180deg,rgba(2,6,23,.65), rgba(2,6,23,.15))}
    .card{background:var(--card);border:1px solid rgba(148,163,184,.12);border-radius:18px;padding:16px;box-shadow:inset 0 1px 0 rgba(255,255,255,.02)}
    .meta{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:14px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(148,163,184,.2);color:#cbd5e1;padding:6px 10px;border-radius:999px;font-size:13px}
    .timer{--w:100%;height:10px;background:#111827;border-radius:999px;overflow:hidden;border:1px solid rgba(148,163,184,.2)}
    .timer>i{display:block;height:100%;width:var(--w);background:linear-gradient(90deg,var(--accent),#eab308);transition:width .2s linear}
    .q-title{font-size:clamp(18px,2.4vw,22px);margin:12px 0 6px}
    .options{display:grid;grid-template-columns:1fr;gap:10px;margin-top:14px}
    .option{color: var(--txt); display:flex;gap:10px;align-items:center;background:#0b1220;border:1px solid rgba(148,163,184,.25);border-radius:14px;padding:12px;cursor:pointer;transition:background .2s,border-color .2s}
    .option:hover{background:#0f172a}.option.correct{border-color:rgba(34,197,94,.8)}.option.wrong{border-color:rgba(239,68,68,.9)}
    .explain{margin-top:10px;color:#cbd5e1;font-size:14px}
    .leaderboard h3,.rules h3,.settings h3{margin:8px 0 12px;font-size:18px}
    .lb-list{display:grid;gap:8px}.lb-item{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#0b1220;border:1px solid rgba(148,163,184,.18);border-radius:12px}
    .muted{color:var(--muted)}
    .end{display:none;gap:16px}.end.active{display:block}.center{text-align:center}.small{font-size:12px;color:var(--muted)}.hidden{display:none}
    .badge{background:linear-gradient(90deg,#22c55e,#3b82f6);color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;margin-inline-start:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    select,input[type="number"],input[type="text"]{padding:8px 10px;border-radius:12px;border:1px solid rgba(148,163,184,.3);background:#0b1220;color:#e5e7eb}
    .switch{display:inline-flex;align-items:center;gap:8px}
    .switch input{accent-color:#22c55e}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>CyberSecure Quiz <span class="badge">Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</span></h1>
      <div class="actions">
        <button class="btn ghost" id="toggleDir">RTL/LTR</button>
        <button class="btn" id="resetBtn">Ø¥Ø¹Ø§Ø¯Ø©</button>
        <button class="btn primary" id="headerStartBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
      </div>
    </header>

    <div class="content">
      <main class="main">
        <div class="card">
          <div class="meta">
            <div>Ø§Ù„Ø³Ø¤Ø§Ù„ <b id="qIndex">0</b>/<b id="qTotal">0</b></div>
            <div>Ø§Ù„Ù†Ù‚Ø§Ø·: <b id="score">0</b></div>
            <div>Ø³Ù„Ø³Ù„Ø© ØµØ­ÙŠØ­Ø©: <b id="streak">0</b></div>
            <div>Ø²Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„: <b id="sec">0</b>s</div>
          </div>
          <div class="timer" aria-hidden="true"><i id="bar"></i></div>
          <h2 class="q-title" id="qTitle">Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨" Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚</h2>
          <div class="options" id="options"></div>
          <div class="explain" id="explain"></div>
          <div class="center" style="margin-top:14px">
            <button class="btn success hidden" id="nextBtn">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
          </div>
        </div>

        <div class="card end" id="endCard">
          <h2 class="center">Ø£Ø­Ø³Ù†Øª! Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ‰</h2>
          <p class="center">Ø¯Ø±Ø¬ØªÙƒ: <b id="finalScore">0</b></p>
          <div class="center" style="margin:10px 0">
            <input id="playerName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø­ÙØ¸ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù" style="padding:10px 12px;border-radius:12px;border:1px solid rgba(148,163,184,.3);background:#0b1220;color:#e5e7eb;width:min(420px,90%)" />
            <button class="btn primary" id="saveLB">Ø­ÙØ¸</button>
          </div>
          <div class="center row" style="justify-content:center">
            <button class="btn" id="playAgain">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn ghost" id="shareBtn">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¯Ø±Ø¬Ø©</button>
            <button class="btn ghost" id="qrBtn">QR</button>
          </div>
          <canvas id="qrCanvas" class="hidden" width="220" height="220" style="margin:10px auto;display:block;background:#fff;border-radius:12px;padding:6px"></canvas>
        </div>
      </main>

      <aside class="panel">
        <section class="settings">
          <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆÙ„Ø© âš™ï¸</h3>
          <div class="row">
            <label class="switch">Ø§Ù„Ù„ØºØ©:
              <select id="langSel">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
              </select>
            </label>
            <label class="switch">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:
              <select id="levelSel">
                <option value="easy">Ø³Ù‡Ù„</option>
                <option value="med" selected>Ù…ØªÙˆØ³Ø·</option>
                <option value="hard">ØµØ¹Ø¨</option>
              </select>
            </label>
            <label class="switch">Ø§Ù„ØªØµÙ†ÙŠÙ:
              <select id="catSel">
                <option value="all" selected>Ø§Ù„ÙƒÙ„</option>
                <option value="passwords">Passwords</option>
                <option value="phishing">Phishing</option>
                <option value="wifi">Wiâ€‘Fi & VPN</option>
              </select>
            </label>
          </div>
          <div class="row" style="margin-top:8px">
            <label class="switch"><input type="checkbox" id="soundChk" checked> Ø£ØµÙˆØ§Øª</label>
            <label class="switch"><input type="checkbox" id="negChk"> Ø®ØµÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·Ø£ (â€‘10)</label>
            <label class="switch hidden"><input type="checkbox" id="streakChk" checked> Ù…Ø¶Ø§Ø¹Ù Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</label>
            <button class="btn ghost" id="settingsToggleDir">RTL/LTR</button>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="settingsResetBtn">Ø¥Ø¹Ø§Ø¯Ø©</button>
            <button class="btn primary" id="settingsStartBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
          </div>
        </section>

        <section class="leaderboard" style="margin-top:16px">
          <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù ğŸ†</h3>
          <div class="lb-list" id="lbList"></div>
          <p class="small">ÙŠØªÙ… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­. ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£Ø¯Ù†Ø§Ù‡.</p>
        </section>
        <section class="rules" style="margin-top:16px">
          <h3>Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
          <div class="row">
            <button class="btn ghost" id="exportBtn">ØªØµØ¯ÙŠØ± JSON</button>
            <label class="btn ghost" for="importFile">Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</label>
            <input id="importFile" type="file" accept="application/json" class="hidden" />
          </div>
          <p class="small">ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„: {type, q, options[], answer, explain, category, lang}</p>
        </section>
        <section class="rules" style="margin-top:16px">
          <h3>Ù‚ÙˆØ§Ø¹Ø¯ Ø³Ø±ÙŠØ¹Ø©</h3>
          <ul class="muted" style="margin-top:6px;line-height:1.8">
            <li>Ø§Ù„Ø²Ù…Ù† ÙŠØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ (Ø³Ù‡Ù„ 25s / Ù…ØªÙˆØ³Ø· 20s / ØµØ¹Ø¨ 12s).</li>
            <li>Ù†Ù‚Ø§Ø· ØµØ­ÙŠØ­Ø© Ø­ØªÙ‰ 100 + Ù…ÙƒØ§ÙØ£Ø© Ø³Ù„Ø³Ù„Ø© ØµØ­ÙŠØ­Ø©.</li>
            <li>ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø®ØµÙ… â€‘10 Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£.</li>
          </ul>
        </section>
      </aside>
    </div>
  </div>
  </div>

  <script>
    // ===== ØªØ±Ø¬Ù…Ø§Øª Ø¨Ø³ÙŠØ·Ø© =====
    const I18N = {
      ar: {
        start: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨', next: 'Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ', finished: 'Ø£Ø­Ø³Ù†Øª! Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ‰',
        yourScore: 'Ø¯Ø±Ø¬ØªÙƒ', noResults: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯.'
      },
      en: {
        start: 'Start', next: 'Next', finished: 'Great! Round finished ğŸ‰',
        yourScore: 'Your score', noResults: 'No results yet.'
      }
    };

    // ===== Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª/Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª =====
    let QUESTIONS = [
      {lang:'ar', category:'passwords', type:'mcq', q:'Ø£ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø£Ù‚ÙˆÙ‰ØŸ', options:['Riyadh2024','R!y@dh-2_0_2_4','12345678','Qwerty!'], answer:1, explain:'Ø§Ù„Ø£Ù‚ÙˆÙ‰ Ù…Ø²ÙŠØ¬ Ù…Ù† Ø£Ø­Ø±Ù ÙƒØ¨ÙŠØ±Ø©/ØµØºÙŠØ±Ø© + Ø£Ø±Ù‚Ø§Ù… + Ø±Ù…ÙˆØ²ØŒ ÙˆØ·ÙˆÙ„ 12+.'},
      {lang:'ar', category:'phishing', type:'tf', q:'ØªÙØ¹ÙŠÙ„ 2FA ÙŠÙ‚Ù„Ù„ Ù…Ù† Ø®Ø·Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ø­Ø³Ø§Ø¨Ùƒ.', options:['ØµØ­','Ø®Ø·Ø£'], answer:0, explain:'2FA ÙŠØ¶ÙŠÙ Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© Ø«Ø§Ù†ÙŠØ© Ø¨Ø¹Ø¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.'},
      {lang:'ar', category:'phishing', type:'scenario', q:'ÙˆØµÙ„Ùƒ Ø¥ÙŠÙ…ÙŠÙ„ Ø®ØµÙ… 90% ÙˆØ·Ù„Ø¨ Ø¨Ø·Ø§Ù‚ØªÙƒ. Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ØŸ', options:['Ø£Ø¶ØºØ· Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø³Ø±Ø¹Ø©','Ø£ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ù…Ø±Ø³Ù„ ÙˆØ£ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ'], answer:1, explain:'Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¶Ø®Ù…Ø© Ø§Ù„Ù…Ø³ØªØ¹Ø¬Ù„Ø© ØªÙƒØªÙŠÙƒ ØªØµÙŠÙ‘Ø¯.'},
      {lang:'ar', category:'phishing', type:'mcq', q:'Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØµÙŠÙ‘Ø¯ (Phishing)ØŸ', options:['Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø¨ÙƒØ©','Ø®Ø¯Ø§Ø¹Ùƒ Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ','ØªØ­Ø¯ÙŠØ«Ø§Øª Ø£Ù…Ù†ÙŠØ©','Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ'], answer:1, explain:'Ø±Ø³Ø§Ø¦Ù„/Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø²ÙˆØ±Ø© ØªÙ‚Ù„Ù‘Ø¯ Ø¬Ù‡Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø©.'},
      {lang:'ar', category:'wifi', type:'mcq', q:'Ø£ÙŠ Ø§Ù…ØªØ¯Ø§Ø¯ Ù…Ù„Ù ØªØ­Ø°Ø± Ù…Ù†Ù‡ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ØŸ', options:['.pdf','.jpg','.exe','.txt'], answer:2, explain:'Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ¯ Ù‚Ø¯ ØªØ­ØªÙˆÙŠ Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø®Ø¨ÙŠØ«Ø©.'},
      {lang:'ar', category:'wifi', type:'tf', q:'ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ø³Ø¯ Ø§Ù„Ø«ØºØ±Ø§Øª.', options:['ØµØ­','Ø®Ø·Ø£'], answer:0, explain:'ØªÙØ­Ø³Ù† Ø§Ù„Ø­Ù…Ø§ÙŠØ©.'},
      {lang:'ar', category:'wifi', type:'scenario', q:'Wiâ€‘Fi Ø¹Ø§Ù…Ø© Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±. Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ØŸ', options:['Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ø§Ù„Ø¨Ù†ÙƒÙŠØ©','Ø£Ø³ØªØ®Ø¯Ù… VPN Ø£Ùˆ Ø£Ø¤Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©'], answer:1, explain:'ØªØ¬Ù†Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø© Ø¹Ù„Ù‰ Ø´Ø¨ÙƒØ§Øª Ø¹Ø§Ù…Ø©.'},
      
      // Ø£Ø³Ø¦Ù„Ø© Ø¹Ø±Ø¨ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
      {lang:'ar', category:'phishing', type:'mcq', q:'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©ØŸ', options:['Ù‡Ø¬Ù…Ø§Øª Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©','Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø¯Ø§Ø¹ Ø§Ù„Ù†ÙØ³ÙŠ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ©','Ø§Ø®ØªØ±Ø§Ù‚ Ø´Ø¨ÙƒØ© Ø§Ù„ÙˆØ§ÙŠ ÙØ§ÙŠ','ØªØ·ÙˆÙŠØ± ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø£Ù…Ù†ÙŠØ©'], answer:1, explain:'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ.'},
      {lang:'ar', category:'passwords', type:'mcq', q:'Ù…Ø§ Ù‡ÙŠ Ø£Ù‡Ù…ÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¯ÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±ØŸ', options:['Ù„Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·','Ù„ØªØ­Ø³ÙŠÙ† Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª','Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ®Ø²ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ© ÙˆÙØ±ÙŠØ¯Ø© Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†','Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¢Ù…Ù†Ø©'], answer:2, explain:'Ù…Ø¯ÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ³Ù‡Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ù…Ø¹Ù‚Ø¯Ø© ÙˆÙ…Ø®ØªÙ„ÙØ© Ù„ÙƒÙ„ Ù…ÙˆÙ‚Ø¹.'},
      {lang:'ar', category:'wifi', type:'tf', q:'Ø´Ø¨ÙƒØ© Wi-Fi Ø§Ù„ØªÙŠ ØªØ­Ù…Ù„ Ø§Ø³Ù… "Free Public Wi-Fi" Ù‡ÙŠ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¢Ù…Ù†Ø©.', options:['ØµØ­','Ø®Ø·Ø£'], answer:1, explain:'Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© ØºØ§Ù„Ø¨Ù‹Ø§ Ù…Ø§ ØªÙƒÙˆÙ† ØºÙŠØ± Ø¢Ù…Ù†Ø© ÙˆÙ‚Ø¯ ØªØ³Ù…Ø­ Ù„Ù„Ù…ØªØ³Ù„Ù„ÙŠÙ† Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.'},
      
      // English questions
      {lang:'en', category:'passwords', type:'mcq', q:'What is a good way to protect your passwords?', options:['Reuse the same password on all sites','Write them down on a sticky note','Use a strong, unique password for each account'], answer:2, explain:'Using unique, strong passwords prevents one compromised account from affecting others.'},
      {lang:'en', category:'phishing', type:'tf', q:'Phishing emails are always easy to spot.', options:['True','False'], answer:1, explain:'Modern phishing emails can be very convincing and hard to distinguish from legitimate ones.'},
      {lang:'en', category:'phishing', type:'mcq', q:'Which of the following is a sign of a phishing attempt?', options:['A generic greeting like "Dear Customer"','An urgent request for personal information','A link with a suspicious URL','All of the above'], answer:3, explain:'Phishing attempts often use a combination of these tactics to deceive you.'},
      {lang:'en', category:'wifi', type:'mcq', q:'What is a firewall?', options:['A physical wall to block hackers','A security system that controls network traffic','A type of antivirus software','A public Wi-Fi access point'], answer:1, explain:'A firewall acts as a barrier, monitoring and controlling incoming and outgoing network traffic.'},
      {lang:'en', category:'wifi', type:'tf', q:'Using a VPN on public Wi-Fi is a good security practice.', options:['True','False'], answer:0, explain:'A VPN encrypts your traffic, protecting your data from being intercepted on unsecured networks.'},
      {lang:'en', category:'passwords', type:'scenario', q:'You receive a text from a bank asking you to log in to verify your account. What should you do?', options:['Click the link and log in immediately','Call the bank using the number on their official website','Reply to the text asking for more info'], answer:1, explain:'Never click on links in suspicious messages. Always use an official, verified contact method.'},
      
      // English questions additional
      {lang:'en', category:'phishing', type:'mcq', q:'What does "malware" stand for?', options:['Malicious software','Management software','Marketing software','Maintenance software'], answer:0, explain:'Malware is a broad term for any malicious software designed to harm or exploit a device.'},
      {lang:'en', category:'phishing', type:'tf', q:'It is safe to download attachments from senders you don\'t know.', options:['True','False'], answer:1, explain:'Unknown attachments can contain malware, so it\'s best to avoid them.'},
      {lang:'en', category:'passwords', type:'mcq', q:'Why is it important to update your software and operating system regularly?', options:['To get new features','To fix bugs and security vulnerabilities','To change the look of the interface','To make your device run faster'], answer:1, explain:'Updates often include security patches that fix weaknesses hackers can exploit.'},
      {lang:'en', category:'wifi', type:'tf', q:'You should disable Bluetooth and Wi-Fi when you are not using them.', options:['True','False'], answer:0, explain:'Disabling them reduces your device\'s visibility and potential attack surface.'}
    ];
    // ===== Ø£ØµÙˆØ§Øª Ø®ÙÙŠÙØ© =====
    const SND = {
      ok: new Audio(URL.createObjectURL(new Blob([new Uint8Array([82,73,70,70,26,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,1,0,8,0,100,97,116,97,2,0,0,0,255,127])],{type:'audio/wav'}))),
      no: new Audio(URL.createObjectURL(new Blob([new Uint8Array([82,73,70,70,26,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,1,0,8,0,100,97,116,97,2,0,0,0,0,128])],{type:'audio/wav'})))
    };

    // ===== Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© =====
    const state = { idx:0, score:0, order:[], running:false, time:20, timerId:null, streak:0 };

    // DOM
    const qTitle = document.getElementById('qTitle');
    const optionsEl = document.getElementById('options');
    const explainEl = document.getElementById('explain');
    const qIndexEl = document.getElementById('qIndex');
    const qTotalEl = document.getElementById('qTotal');
    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');
    const secEl = document.getElementById('sec');
    const barEl = document.getElementById('bar');
    const nextBtn = document.getElementById('nextBtn');
    const headerStartBtn = document.getElementById('headerStartBtn');
    const headerResetBtn = document.getElementById('resetBtn');
    const settingsStartBtn = document.getElementById('settingsStartBtn');
    const settingsResetBtn = document.getElementById('settingsResetBtn');
    const endCard = document.getElementById('endCard');
    const finalScore = document.getElementById('finalScore');
    const playAgain = document.getElementById('playAgain');
    const playerName = document.getElementById('playerName');
    const saveLB = document.getElementById('saveLB');
    const lbList = document.getElementById('lbList');
    const headerToggleDir = document.getElementById('toggleDir');
    const settingsToggleDir = document.getElementById('settingsToggleDir');
    const langSel = document.getElementById('langSel');
    const levelSel = document.getElementById('levelSel');
    const catSel = document.getElementById('catSel');
    const soundChk = document.getElementById('soundChk');
    const negChk = document.getElementById('negChk');
    const streakChk = document.getElementById('streakChk');
    const shareBtn = document.getElementById('shareBtn');
    const qrBtn = document.getElementById('qrBtn');
    const qrCanvas = document.getElementById('qrCanvas');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');

    // ===== Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© =====
    const shuffle = arr => arr.map(v=>[v,Math.random()]).sort((a,b)=>a[1]-b[1]).map(x=>x[0]);
    const clamp = (n,min,max)=> Math.max(min, Math.min(max,n));

    function loadLB(){try{return JSON.parse(localStorage.getItem('cyber_leaderboard')||'[]')}catch{return[]}}
    function saveLBData(rows){localStorage.setItem('cyber_leaderboard', JSON.stringify(rows.slice(0,20)))}
    function renderLB(){
      const rows = loadLB();
      lbList.innerHTML = rows.length? '' : `<span class="muted">${I18N[langSel.value].noResults}</span>`;
      rows.forEach((r,i)=>{
        const div=document.createElement('div');div.className='lb-item';div.innerHTML=`<span>#${i+1} â€” ${r.name}</span><b>${r.score}</b>`;lbList.appendChild(div);
      });
    }

    // ===== Ù…Ù†Ù‚ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©/Ø§Ù„ØªØµÙ†ÙŠÙ =====
    function pool(){
      const lang = langSel.value, cat = catSel.value;
      const arr = QUESTIONS.filter(q => q.lang===lang && (cat==='all' || q.category===cat));
      return arr.length? arr : QUESTIONS.filter(q=>q.lang===lang); // fallback
    }

    function startGame(){
      state.idx=0; state.score=0; state.running=true; state.streak=0; endCard.classList.remove('active');
      const items = pool();
      state.order = shuffle([...Array(items.length).keys()]);
      qTotalEl.textContent = items.length; scoreEl.textContent=0; streakEl.textContent=0; nextBtn.classList.add('hidden');
      renderQuestion();
    }

    function levelTime(){ return levelSel.value==='easy'?25 : levelSel.value==='hard'?12 : 20; }

    function renderQuestion(){
      clearInterval(state.timerId); explainEl.textContent=''; optionsEl.innerHTML=''; nextBtn.classList.add('hidden');
      const items = pool(); const qi = state.order[state.idx]; const q = items[qi];
      qIndexEl.textContent = state.idx + 1; qTitle.textContent = q.q;
      q.options.forEach((opt, idx)=>{ const btn=document.createElement('button'); btn.className='option'; btn.innerHTML=`<span class="pill">${idx+1}</span> <span>${opt}</span>`; btn.onclick=()=>pick(idx,q); optionsEl.appendChild(btn); });
      state.time = levelTime(); secEl.textContent=state.time; barEl.style.setProperty('--w','100%');
      state.timerId=setInterval(()=>{ state.time-=1; secEl.textContent=state.time; const w=clamp((state.time/levelTime())*100,0,100); barEl.style.setProperty('--w', w+'%'); if(state.time<=0){ clearInterval(state.timerId); lock(null,q); } },1000);
    }

    function pick(idx,q){ if(!state.running) return; clearInterval(state.timerId); lock(idx,q); }

    function lock(idx,q){
      const nodes=[...document.querySelectorAll('.option')]; nodes.forEach(n=> n.onclick=null);
      const items = pool(); const correct=q.answer; nodes.forEach((n,i)=>{ if(i===correct) n.classList.add('correct'); });
      if(idx!==null && idx!==undefined){
        if(idx===correct){
          const base = Math.round(50 + (state.time/levelTime())*50);
          state.streak += 1; let bonus = (streakChk.checked? (state.streak-1)*10 : 0); const gained = base + bonus; state.score += gained; if(soundChk.checked) SND.ok.play();
        } else {
          state.streak = 0; if(negChk.checked) state.score = Math.max(0, state.score - 10); nodes[idx].classList.add('wrong'); if(soundChk.checked) SND.no.play();
        }
      } else { state.streak=0; if(negChk.checked) state.score = Math.max(0, state.score - 10); }
      scoreEl.textContent = state.score; streakEl.textContent=state.streak; explainEl.textContent = q.explain || '';
      nextBtn.classList.remove('hidden');
    }

    function next(){ if(state.idx < state.order.length-1){ state.idx+=1; renderQuestion(); } else { end(); } }
    function end(){ state.running=false; clearInterval(state.timerId); finalScore.textContent=state.score; endCard.classList.add('active'); }

    // ===== Ù…Ø´Ø§Ø±ÙƒØ© Ùˆ QR =====
    shareBtn.addEventListener('click', async () => {
    const txt = `${document.title} - ${state.score}`;
    try {
      await navigator.clipboard.writeText(txt + ' ' + location.href);
      alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·! ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ø§Ù„Ø¢Ù†.');
    } catch (err) {
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®.');
    }
});

    // QR Ø¨Ø³ÙŠØ· (Placeholder patternØŒ Ù„Ø§ ÙŠØ¹ØªÙ…Ø¯ Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©)
    qrBtn?.addEventListener('click', ()=>{
      const c=qrCanvas, ctx=c.getContext('2d'); c.classList.toggle('hidden');
      if(c.classList.contains('hidden')) return;
      ctx.fillStyle='#fff'; ctx.fillRect(0,0,c.width,c.height);
      // Ø±Ø³Ù… Ù…Ø±Ø¨Ø¹Ø§Øª Ù†Ù…Ø·ÙŠØ© (Ù„ÙŠØ³ QR Ø­Ù‚ÙŠÙ‚ÙŠØ› Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙ‚Ø·)
      ctx.fillStyle='#000';
      for(let y=0;y<21;y++) for(let x=0;x<21;x++) if(((x*y + x + y)%7)===0) ctx.fillRect(10+x*9,10+y*9,7,7);
      ctx.fillStyle='#000'; ctx.fillRect(12,12,50,50); ctx.clearRect(20,20,34,34); // Ø¹ÙŠÙ†
      ctx.fillRect(158,12,50,50); ctx.clearRect(166,20,34,34);
      ctx.fillRect(12,158,50,50); ctx.clearRect(20,166,34,34);
    });

    // ===== ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© =====
    exportBtn?.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(QUESTIONS,null,2)], {type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='questions.json'; a.click(); URL.revokeObjectURL(a.href);
    });
    importFile?.addEventListener('change', async (e)=>{
      const file = e.target.files?.[0]; if(!file) return; const txt = await file.text();
      try{ const data = JSON.parse(txt); if(Array.isArray(data)){ QUESTIONS = data; alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­'); } else alert('ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); }
      catch{ alert('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'); }
    });

    // ===== Ø£Ø­Ø¯Ø§Ø« Ø¹Ø§Ù…Ø© =====
    headerStartBtn.addEventListener('click', startGame);
    headerResetBtn.addEventListener('click', ()=>{ state.running=false; clearInterval(state.timerId); startGame(); });
    settingsStartBtn.addEventListener('click', startGame);
    settingsResetBtn.addEventListener('click', ()=>{ state.running=false; clearInterval(state.timerId); startGame(); });
    nextBtn.addEventListener('click', next);
    playAgain.addEventListener('click', startGame);
    saveLB.addEventListener('click', ()=>{ const name=(playerName.value||'Ù„Ø§Ø¹Ø¨ Ù…Ø¬Ù‡ÙˆÙ„').slice(0,32); const rows=loadLB(); rows.push({name,score:state.score,ts:Date.now()}); rows.sort((a,b)=> b.score-a.score || a.ts-b.ts); saveLBData(rows); renderLB(); playerName.value=''; });
    headerToggleDir.addEventListener('click', ()=>{ const r=document.documentElement; r.setAttribute('dir', r.getAttribute('dir')==='rtl' ? 'ltr' : 'rtl'); });
    settingsToggleDir.addEventListener('click', ()=>{ const r=document.documentElement; r.setAttribute('dir', r.getAttribute('dir')==='rtl' ? 'ltr' : 'rtl'); });
    langSel.addEventListener('change', ()=>{ renderLB(); });

    // Ø¨Ø¯Ø§ÙŠØ©
    renderLB();
  </script>
</body>
</html>
